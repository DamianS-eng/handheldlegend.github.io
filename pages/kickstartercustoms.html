<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hand Held Legend – Customs Letter Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; color: #333; margin: 0; padding: 0; }
    .container { max-width: 800px; margin: 30px auto; background: #fff; padding: 20px 30px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    h1 { font-size: 20px; margin-bottom: 5px; }
    small { color: #666; }
    .logo-preview img { max-width: 180px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    label { font-weight: bold; font-size: 14px; }
    input { padding: 8px; font-size: 14px; border: 1px solid #ccc; border-radius: 4px; }
    .buttons { margin-top: 20px; }
    .btn { background: #007BFF; color: #fff; border: none; padding: 10px 15px; margin-right: 10px; border-radius: 4px; cursor: pointer; }
    .btn.secondary { background: #6c757d; }
    .note { margin-top: 10px; font-size: 12px; color: #666; }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo-preview"><img src="https://handheldlegend.com/cdn/shop/files/t-shirt-file.png?v=1654286501&width=280" alt="Logo"></div>
    <h1>Hand Held Legend – Customs Letter</h1>
    <small>Company info is pre-filled. Fill in your shipment details below.</small>

    <div class="grid" style="margin-top:20px;">
      <div><label>Recipient Name</label><input id="recipient" placeholder="Customer Name" /></div>
      <div><label>Tracking Number</label><input id="tracking" placeholder="1Z999..." /></div>
      <div><label>Kickstarter Pledge Date</label><input id="pledgeDate" type="date" /></div>
      <div><label>Kickstarter Payment Amount (USD)</label><input id="amountPaid" type="number" step="0.01" placeholder="100.00" /></div>
    </div>

    <div class="buttons">
      <button class="btn" id="generateBtn">Generate & Save PDF</button>
      <button class="btn secondary" id="printBtn">Open for Printing</button>
    </div>

    <p class="note">If your PDF text ever runs off the page, this version hard-wraps content and paginates automatically.</p>
  </div>

  <script>
    const COMPANY = {
      name: 'Hand Held Legend, LLC',
      signatory: 'Mitchell Cairns',
      email: 'mitch.cairns@handheldlegend.com',
      phone: '+1-408-455-0435',
      address: '519 Davisville Road, Unit 102\nWillow Grove, PA 19090\nUSA'
    };

    function fmtUSD(n) { return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(Number(n)); }
    function prettyDate(iso) { const d = new Date(iso + 'T00:00:00'); return d.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }); }

    function buildLetterText(v) {
      const paid = fmtUSD(v.amountPaid);
      const pledge = prettyDate(v.pledgeDate);
      const todayNice = prettyDate(v.today);
      return `To Whom It May Concern,\n\nI am writing on behalf of ${COMPANY.name} regarding a recent shipment to the recipient named below.\n\nDue to a technical integration error between our Kickstarter fulfillment workflow and Shopify, the declared customs value on this shipment was incorrectly reported. The recipient originally pledged for this item via our Kickstarter campaign and paid a lower amount than shown on the commercial invoice generated by Shopify. The discrepancy was unintentional and does not reflect the true transaction value.\n\nShipment Details:\n• Recipient Name: ${v.recipient}\n• Tracking Number: ${v.tracking}\n• Kickstarter Pledge Date: ${pledge}\n• Kickstarter Payment Amount (Actual Value): ${paid}\n• Country of Origin (Actual): China\n• Product: Game controller device\n\nThe correct customs value for duty and tax calculation purposes should be ${paid}, based on the actual country of origin and payment made by the recipient during the Kickstarter campaign.\n\nWe apologize for the confusion caused by this technical error. If you require additional information, documentation, or confirmation, please feel free to contact me directly:\n\nContact:\n${COMPANY.signatory}\n${COMPANY.name}\nEmail: ${COMPANY.email}\nPhone: ${COMPANY.phone}\n\nThank you for your understanding, and we appreciate your assistance in correcting this matter.\n\nSincerely,\n\n${COMPANY.signatory}\n${COMPANY.name}\n\n${todayNice}`;
    }

    function collectValues() {
      return {
        recipient: document.getElementById('recipient').value.trim(),
        tracking: document.getElementById('tracking').value.trim(),
        pledgeDate: document.getElementById('pledgeDate').value,
        amountPaid: document.getElementById('amountPaid').value,
        today: new Date().toISOString().slice(0,10),
      };
    }

    function renderWrappedLetter(doc, text) {
      const margin = 20;            // mm
      const lineHeight = 5;         // mm per line
      const pageWidth = doc.internal.pageSize.getWidth();
      const pageHeight = doc.internal.pageSize.getHeight();
      const contentWidth = pageWidth - margin * 2;
      const lines = doc.splitTextToSize(text, contentWidth);

      let y = margin;               // start below top margin
      doc.setFontSize(12);
      lines.forEach(line => {
        if (y > pageHeight - margin) { // new page when reaching bottom margin
          doc.addPage();
          y = margin;
        }
        doc.text(line, margin, y);
        y += lineHeight;
      });
    }

    document.getElementById('generateBtn').addEventListener('click', () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const values = collectValues();
      const body = buildLetterText(values);
      renderWrappedLetter(doc, body);
      doc.save('Customs_Letter.pdf');
    });

    document.getElementById('printBtn').addEventListener('click', () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const values = collectValues();
      const body = buildLetterText(values);
      renderWrappedLetter(doc, body);
      window.open(doc.output('bloburl'), '_blank');
    });
  </script>
</body>
</html>
